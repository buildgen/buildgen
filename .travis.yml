language: cpp
compiler:
 - gcc
 - clang

before_install:
 - sudo apt-get install cmake lua50 luarocks libgtest-dev
 - sudo luarocks install luafilesystem
 - sudo luarocks install penlight
 - SRC="$(pwd)"
 - mkdir "$SRC/gtest/" && cd "$SRC/gtest/" && cmake /usr/src/gtest/ && make && sudo cp libgtest.a libgtest_main.a /usr/lib/
 - cd "$SRC"
script:
 - SRC="$(pwd)"
 - OLDPATH=$PATH
 - mkdir "$SRC/cmake/" && cd "$SRC/cmake/" && cmake "-DCMAKE_INSTALL_PREFIX:PATH=$SRC/cmakeins/" .. && make install
 - PATH="$SRC/cmakeins/bin/:$OLDPATH"
 - mkdir "$SRC/bg0/"    && cd "$SRC/bg0/"    && sudo gen -Ddebug -Dtest "-Dprefix=$SRC/bgins0/" .. && make install
 - PATH="$SRC/bgins0/bin/:$OLDPATH"
 - mkdir "$SRC/bg1/"    && cd "$SRC/bg1/"    && sudo gen -Ddebug -Dtest "-Dprefix=$SRC/bgins1/" .. && make test

 - cd "$SRC/
 - bg1/buildgen-exe/test
